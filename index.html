<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ç©ã¿å´©ã—ãƒ“ãƒ³ã‚´</title>

<link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root {
  --main: #ff7a9e;
  --sub: #fff5f8;
  --border: #ff9bb3;
}

body {
  font-family: "Kiwi Maru", sans-serif;
  background: linear-gradient(135deg, #ffdde1, #ee9ca7);
  display: flex;
  justify-content: center;
  padding: 20px;
}

.container {
  background: white;
  padding: 20px;
  border-radius: 20px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  width: 100%;
  max-width: 380px;
}

.year-input {
  text-align: center;
  margin-bottom: 10px;
}

.year-input input {
  font-size: 22px;
  border: none;
  border-bottom: 3px solid var(--main);
  text-align: center;
  width: 120px;
}

.title {
  text-align: center;
  font-size: 18px;
  color: var(--main);
  margin-bottom: 10px;
}

.theme-select {
  text-align: center;
  margin-bottom: 10px;
}

.theme-select button {
  margin: 0 3px;
  padding: 5px 10px;
  border-radius: 15px;
  border: none;
  cursor: pointer;
}

.bingo-wrapper {
  position: relative;
}

.bingo {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
}

.cell {
  aspect-ratio: 1 / 1;
  background: var(--sub);
  border: 2px dashed var(--border);
  border-radius: 15px;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  font-size: 14px;
  padding: 6px;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.cell img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  background: white;
}

.cell.empty::after {
  content: "+";
  font-size: 28px;
  color: var(--border);
}

.cell.free {
  background: var(--main);
  color: white;
  font-size: 20px;
  font-weight: bold;
  border: none;
  cursor: default;
}

.clear-mark {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  animation: pop 0.3s ease;
}

.clear-mark span {
  font-size: 36px;
}

.clear-mark img {
  max-width: 80%;
  max-height: 80%;
}

@keyframes pop {
  from { transform: scale(0); }
  to { transform: scale(1); }
}

/* ===== ãƒ“ãƒ³ã‚´ãƒ©ã‚¤ãƒ³ ===== */
.bingo-line {
  position: absolute;
  background: var(--main);
  height: 6px;
  border-radius: 5px;
  transform-origin: left center;
  animation: draw 0.4s ease forwards;
}

@keyframes draw {
  from { transform: scaleX(0); }
  to { transform: scaleX(1); }
}

.footer-url {
  text-align: center;
  margin-top: 10px;
  font-size: 10px;
  color: #999;
}

.buttons {
  text-align: center;
  margin-top: 15px;
}

button.main {
  background: var(--main);
  color: white;
  border: none;
  padding: 8px 18px;
  border-radius: 20px;
  cursor: pointer;
}

/* ===== ãƒ¢ãƒ¼ãƒ€ãƒ« ===== */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 100;
}

.modal-content {
  background: white;
  padding: 20px;
  border-radius: 20px;
  width: 280px;
  text-align: center;
}

.modal-content button {
  display: block;
  width: 100%;
  margin: 8px 0;
  padding: 10px;
  border-radius: 15px;
  border: none;
  background: var(--sub);
  cursor: pointer;
}
</style>
</head>

<body>
<div class="container" id="captureArea">
  <div class="year-input">
    <input type="number" placeholder="2026"> å¹´
  </div>

  <div class="title">ç©ã¿å´©ã—ãƒ“ãƒ³ã‚´</div>

  <div class="theme-select">
    <button onclick="setTheme('#ff7a9e','#fff5f8','#ff9bb3')">ğŸŒ¸</button>
    <button onclick="setTheme('#7ad7ff','#f3fbff','#9bdcff')">ğŸ’</button>
    <button onclick="setTheme('#7affb2','#f5fff9','#9bffd1')">ğŸ€</button>
  </div>

  <div class="bingo-wrapper" id="bingoWrapper">
    <div class="bingo" id="bingo">
      <div class="cell empty"></div>
      <div class="cell empty"></div>
      <div class="cell empty"></div>

      <div class="cell empty"></div>
      <div class="cell free">FREE</div>
      <div class="cell empty"></div>

      <div class="cell empty"></div>
      <div class="cell empty"></div>
      <div class="cell empty"></div>
    </div>
  </div>

  <div class="footer-url">
    https://lv1-games.github.io/game-bingo/
  </div>
</div>

<div class="buttons">
  <button class="main" onclick="saveImage()">ç”»åƒã¨ã—ã¦ä¿å­˜</button>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <button onclick="inputText()">ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›</button>
    <button onclick="uploadImage()">ğŸ–¼ ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
    <button onclick="setClearText()">ğŸ”¤ ã‚¯ãƒªã‚¢æ–‡å­—</button>
    <button onclick="setClearImage()">ğŸ–¼ ã‚¯ãƒªã‚¢ç”»åƒ</button>
    <button onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
  </div>
</div>

<input type="file" id="fileInput" accept="image/*" hidden>

<script>
const cells = document.querySelectorAll(".cell");
const modal = document.getElementById("modal");
const fileInput = document.getElementById("fileInput");
const wrapper = document.getElementById("bingoWrapper");
let activeCell = null;

cells.forEach(cell => {
  if (cell.classList.contains("free")) return;
  cell.addEventListener("click", () => {
    activeCell = cell;
    modal.style.display = "flex";
  });
});

function closeModal() {
  modal.style.display = "none";
}

function inputText() {
  const text = prompt("ã‚²ãƒ¼ãƒ åã‚’å…¥åŠ›");
  if (text && activeCell) {
    activeCell.textContent = text;
    activeCell.classList.remove("empty");
  }
  closeModal();
}

function uploadImage() {
  fileInput.onchange = () => {
    const file = fileInput.files[0];
    if (!file || !activeCell) return;
    const reader = new FileReader();
    reader.onload = e => {
      activeCell.innerHTML = `<img src="${e.target.result}">`;
      activeCell.classList.remove("empty");
    };
    reader.readAsDataURL(file);
    fileInput.value = "";
    closeModal();
  };
  fileInput.click();
}

function removeClearMark(cell) {
  const mark = cell.querySelector(".clear-mark");
  if (mark) mark.remove();
}

function setClearText() {
  const text = prompt("ã‚¯ãƒªã‚¢è¡¨ç¤ºæ–‡å­—");
  if (!text || !activeCell) return;
  removeClearMark(activeCell);
  const mark = document.createElement("div");
  mark.className = "clear-mark";
  mark.innerHTML = `<span>${text}</span>`;
  activeCell.appendChild(mark);
  checkBingo();
  closeModal();
}

function setClearImage() {
  fileInput.onchange = () => {
    const file = fileInput.files[0];
    if (!file || !activeCell) return;
    const reader = new FileReader();
    reader.onload = e => {
      removeClearMark(activeCell);
      const mark = document.createElement("div");
      mark.className = "clear-mark";
      mark.innerHTML = `<img src="${e.target.result}">`;
      activeCell.appendChild(mark);
      checkBingo();
    };
    reader.readAsDataURL(file);
    fileInput.value = "";
    closeModal();
  };
  fileInput.click();
}

/* ===== ãƒ“ãƒ³ã‚´åˆ¤å®š ===== */
function isCleared(index) {
  if (cells[index].classList.contains("free")) return true;
  return cells[index].querySelector(".clear-mark");
}

const lines = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

function checkBingo() {
  document.querySelectorAll(".bingo-line").forEach(l => l.remove());
  lines.forEach(line => {
    if (line.every(isCleared)) drawLine(line);
  });
}

function drawLine(line) {
  const rect1 = cells[line[0]].getBoundingClientRect();
  const rect2 = cells[line[2]].getBoundingClientRect();
  const wrap = wrapper.getBoundingClientRect();

  const x1 = rect1.left + rect1.width/2 - wrap.left;
  const y1 = rect1.top + rect1.height/2 - wrap.top;
  const x2 = rect2.left + rect2.width/2 - wrap.left;
  const y2 = rect2.top + rect2.height/2 - wrap.top;

  const length = Math.hypot(x2-x1, y2-y1);
  const angle = Math.atan2(y2-y1, x2-x1) * 180 / Math.PI;

  const lineEl = document.createElement("div");
  lineEl.className = "bingo-line";
  lineEl.style.width = length + "px";
  lineEl.style.left = x1 + "px";
  lineEl.style.top = y1 + "px";
  lineEl.style.transform = `rotate(${angle}deg)`;

  wrapper.appendChild(lineEl);
}

function saveImage() {
  html2canvas(document.getElementById("captureArea")).then(canvas => {
    const link = document.createElement("a");
    link.download = "game_bingo.png";
    link.href = canvas.toDataURL();
    link.click();
  });
}

function setTheme(main, sub, border) {
  document.documentElement.style.setProperty('--main', main);
  document.documentElement.style.setProperty('--sub', sub);
  document.documentElement.style.setProperty('--border', border);
}
</script>
</body>
</html>
