<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ç©ã¿å´©ã—ãƒ“ãƒ³ã‚´</title>

<link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>

<style>
:root {
  --main:#ff7a9e;
  --sub:#fff5f8;
  --border:#ff9bb3;
}

body {
  font-family:"Kiwi Maru",sans-serif;
  background:linear-gradient(135deg,#ffdde1,#ee9ca7);
  display:flex;
  justify-content:center;
  padding:20px;
}

.container {
  background:white;
  padding:20px;
  border-radius:20px;
  box-shadow:0 10px 25px rgba(0,0,0,.15);
  width:360px;
}

/* ===== å…¥åŠ› ===== */
.name-input,.year-input {
  text-align:center;
  margin-bottom:6px;
}

.name-input input,
.year-input input {
  border:none;
  border-bottom:2px solid var(--main);
  text-align:center;
}

.name-input input { font-size:18px;width:200px; }
.year-input input { font-size:22px;width:120px; }

.title {
  text-align:center;
  color:var(--main);
  margin-bottom:8px;
}

.theme-select { text-align:center;margin-bottom:10px; }
.theme-select button {
  border:none;border-radius:15px;
  padding:5px 10px;cursor:pointer;
}

/* ===== ãƒ“ãƒ³ã‚´ ===== */
.bingo {
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
}

.cell {
  height:110px;
  background:var(--sub);
  border:2px dashed var(--border);
  border-radius:15px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:6px;
  position:relative;
  cursor:pointer;
  overflow:hidden;
}

.cell.empty::after {
  content:"+";
  font-size:28px;
  color:var(--border);
}

.cell img {
  max-width:100%;
  max-height:100%;
  object-fit:contain;
}

.cell.free {
  background:var(--main);
  color:white;
  font-size:20px;
  font-weight:bold;
  border:none;
  cursor:default;
}

/* ===== ç™½ç¸å–ã‚Šãƒ†ã‚­ã‚¹ãƒˆ ===== */
.outline {
  color:#000;
  text-shadow:
    -1px -1px 0 #fff,
     1px -1px 0 #fff,
    -1px  1px 0 #fff,
     1px  1px 0 #fff;
}

/* ===== ã‚¯ãƒªã‚¢ãƒãƒ¼ã‚¯ ===== */
.clear-mark {
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
}

.clear-mark span {
  font-size:65px; /* â† 3å€ */
  line-height:1;
  text-shadow:
    -3px -3px 0 #fff,
     3px -3px 0 #fff,
    -3px  3px 0 #fff,
     3px  3px 0 #fff;
}

.clear-mark img {
  width:56px;height:56px;
  object-fit:contain;
}

/* ===== ãƒ•ãƒƒã‚¿ãƒ¼ ===== */
.footer-url {
  text-align:center;
  font-size:10px;
  color:#999;
  margin-top:8px;
}

/* ===== ãƒœã‚¿ãƒ³ ===== */
.buttons {
  text-align:center;
  margin-top:12px;
}

button.main {
  background:var(--main);
  color:white;
  border:none;
  padding:8px 14px;
  border-radius:20px;
  cursor:pointer;
  margin:4px;
}

/* ===== ãƒ¢ãƒ¼ãƒ€ãƒ« ===== */
.modal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
}

.modal-content {
  background:white;
  padding:20px;
  border-radius:20px;
  width:280px;
}

.modal-content button {
  width:100%;
  margin:6px 0;
  padding:10px;
  border:none;
  border-radius:15px;
  background:var(--sub);
  cursor:pointer;
}
</style>
</head>

<body>
<div class="container" id="captureArea">
  <div class="name-input"><input placeholder="åå‰"></div>
  <div class="year-input"><input type="number" placeholder="2026"> å¹´</div>
  <div class="title">ç©ã¿å´©ã—ãƒ“ãƒ³ã‚´</div>

  <div class="theme-select">
    <button onclick="setTheme('#ff7a9e','#fff5f8','#ff9bb3')">ğŸŒ¸</button>
    <button onclick="setTheme('#7ad7ff','#f3fbff','#9bdcff')">ğŸ’</button>
    <button onclick="setTheme('#7affb2','#f5fff9','#9bffd1')">ğŸ€</button>
  </div>

  <div class="bingo">
    <div class="cell empty"></div><div class="cell empty"></div><div class="cell empty"></div>
    <div class="cell empty"></div><div class="cell free">FREE</div><div class="cell empty"></div>
    <div class="cell empty"></div><div class="cell empty"></div><div class="cell empty"></div>
  </div>

  <div class="footer-url">https://lv1-games.github.io/game-bingo/</div>
</div>

<div class="buttons">
  <button class="main" onclick="saveImage()">ç”»åƒä¿å­˜</button>
  <button class="main" onclick="shareShortURL()">çŸ­ç¸®URLå…±æœ‰</button>
  <button class="main" onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
  <button onclick="inputText()">ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆ</button>
  <button onclick="uploadImage()">ğŸ–¼ ç”»åƒ</button>
ã€€<hr>
ã€€<button onclick="setClearStar()">â­ ã‚¯ãƒªã‚¢ãƒãƒ¼ã‚¯</button>
  <button onclick="setClearText()">ğŸ”¤ ã‚¯ãƒªã‚¢æ–‡å­—</button>
  <button onclick="setClearImage()">ğŸ–¼ ã‚¯ãƒªã‚¢ç”»åƒ</button>
ã€€<button onclick="removeClearMark()">âŒ ã‚¯ãƒªã‚¢ãƒãƒ¼ã‚¯ã‚’å‰Šé™¤</button>
ã€€<hr>
  <button onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
</div>

</div>

<input type="file" id="fileInput" accept="image/*" hidden>

<script>
const STORAGE_KEY="game-bingo-state";
const cells=document.querySelectorAll(".cell");
const modal=document.getElementById("modal");
const fileInput=document.getElementById("fileInput");
let activeCell=null;

cells.forEach(c=>{
  if(c.classList.contains("free"))return;
  c.onclick=()=>{activeCell=c;modal.style.display="flex";}
});

function closeModal(){modal.style.display="none";}

function inputText(){
  const t=prompt("ã‚²ãƒ¼ãƒ å");
  if(t&&activeCell){
    activeCell.innerHTML=`<span class="outline">${t}</span>`;
    activeCell.classList.remove("empty");
    saveState();
  }
  closeModal();
}

function uploadImage(){
  fileInput.onchange=()=>{
    const f=fileInput.files[0];
    if(!f||!activeCell)return;
    const r=new FileReader();
    r.onload=e=>{
      activeCell.innerHTML=`<img src="${e.target.result}">`;
      activeCell.classList.remove("empty");
      saveState();
    };
    r.readAsDataURL(f);
    fileInput.value="";
    closeModal();
  };
  fileInput.click();
}

function clearMark(el){
  const m=el.querySelector(".clear-mark");
  if(m)m.remove();
}

function setClearStar(){
  clearMark(activeCell);
  const m=document.createElement("div");
  m.className="clear-mark";
  m.innerHTML="<span>â­</span>";
  activeCell.appendChild(m);
  saveState();
  closeModal();
}

function setClearText(){
  const t=prompt("ã‚¯ãƒªã‚¢æ–‡å­—");
  if(!t)return;
  clearMark(activeCell);
  const m=document.createElement("div");
  m.className="clear-mark";
  m.innerHTML=`<span>${t}</span>`;
  activeCell.appendChild(m);
  saveState();
  closeModal();
}

function setClearImage(){
  fileInput.onchange=()=>{
    const f=fileInput.files[0];
    if(!f)return;
    const r=new FileReader();
    r.onload=e=>{
      clearMark(activeCell);
      const m=document.createElement("div");
      m.className="clear-mark";
      m.innerHTML=`<img src="${e.target.result}">`;
      activeCell.appendChild(m);
      saveState();
    };
    r.readAsDataURL(f);
    fileInput.value="";
    closeModal();
  };
  fileInput.click();
}

function removeClearMark(){
  if(!activeCell) return;
  clearMark(activeCell);
  saveState();
  closeModal();
}

function getState(){
  return {
    name:document.querySelector(".name-input input").value,
    year:document.querySelector(".year-input input").value,
    cells:Array.from(cells).map(c=>{
      if(c.classList.contains("free"))return{free:true};
      return {html:c.innerHTML};
    })
  };
}

function applyState(s){
  document.querySelector(".name-input input").value=s.name||"";
  document.querySelector(".year-input input").value=s.year||"";
  s.cells.forEach((d,i)=>{
    if(d.free)return;
    cells[i].innerHTML=d.html||"";
    if(d.html)cells[i].classList.remove("empty");
  });
}

function saveState(){
  localStorage.setItem(STORAGE_KEY,JSON.stringify(getState()));
}

function resetAll(){
  if(!confirm("ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ"))return;
  localStorage.removeItem(STORAGE_KEY);
  location.href=location.pathname;
}

async function shareShortURL(){
  const json=JSON.stringify(getState());
  const comp=LZString.compressToEncodedURIComponent(json);
  const long=`${location.origin}${location.pathname}?data=${comp}`;
  const res=await fetch(`https://is.gd/create.php?format=simple&url=${encodeURIComponent(long)}`);
  const short=await res.text();
  navigator.clipboard.writeText(short);
  alert("çŸ­ç¸®URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
}

async function saveImage(){
  await document.fonts.ready;
  html2canvas(captureArea,{scale:1}).then(c=>{
    const a=document.createElement("a");
    a.href=c.toDataURL();
    a.download="game_bingo.png";
    a.click();
  });
}

function setTheme(m,s,b){
  document.documentElement.style.setProperty("--main",m);
  document.documentElement.style.setProperty("--sub",s);
  document.documentElement.style.setProperty("--border",b);
}

window.onload=()=>{
  const p=new URLSearchParams(location.search);
  if(p.get("data")){
    applyState(JSON.parse(LZString.decompressFromEncodedURIComponent(p.get("data"))));
  }else{
    const s=localStorage.getItem(STORAGE_KEY);
    if(s)applyState(JSON.parse(s));
  }
  document.querySelectorAll("input").forEach(i=>i.oninput=saveState);
};
</script>
</body>
</html>
